# ============================================================================
# Solana Arbitrage Bot Configuration
# ============================================================================
# Copy this file to .env and fill in your values
# ----------------------------------------------------------------------------
# Mode Selection (IMPORTANT)
# ----------------------------------------------------------------------------
# NOTE: MODE is NOT read from .env. Mode is selected by CLI argument:
#   python run.py scan|simulate|live
# Example:
#   python run.py simulate

# All absolute limits are in USDC for consistency

# ----------------------------------------------------------------------------
# Solana RPC Configuration
# ----------------------------------------------------------------------------
# RPC URL selection by mode:
# - scan: uses RPC_URL_SCAN (free/public RPC, doesn't consume trial credits)
# - simulate/live: uses RPC_URL_PRIMARY (trial/premium RPC) with automatic failover to RPC_URL_FALLBACK
# 
# Deprecated: RPC_URL (kept for backward compatibility, but RPC_URL_SCAN/PRIMARY/FALLBACK take precedence)
RPC_URL=https://api.mainnet-beta.solana.com

# Scan mode RPC (free/public, doesn't consume trial credits)
RPC_URL_SCAN=https://api.mainnet-beta.solana.com

# Primary RPC for simulate/live modes (trial/premium RPC, required for simulate/live)
RPC_URL_PRIMARY=

# Fallback RPC for simulate/live modes (used automatically when primary fails)
RPC_URL_FALLBACK=

# RPC_URL_WS=wss://api.mainnet-beta.solana.com  # Optional, not currently used - reserved for future WebSocket subscriptions

# ----------------------------------------------------------------------------
# Wallet Configuration
# ----------------------------------------------------------------------------
# Required for 'simulate' and 'live' modes, optional for 'scan' mode
WALLET_PRIVATE_KEY=

# ----------------------------------------------------------------------------
# Jupiter API Configuration
# ----------------------------------------------------------------------------
# Base URL (code automatically handles /v6 or /v1 removal and uses /swap/v1/quote path)
# Leave empty to use fallback mechanism.
# Public endpoints (no auth required): https://quote-api.jup.ag
# Authenticated endpoints (requires API key): https://api.jup.ag
JUPITER_API_URL=
# Optional: Jupiter API key for authenticated requests (enables use of api.jup.ag endpoints)
JUPITER_API_KEY=

# ----------------------------------------------------------------------------
# Risk Management
# ----------------------------------------------------------------------------
# Position size limits
MAX_POSITION_SIZE_PERCENT=50.0  # Maximum position size (% of balance)
MAX_POSITION_SIZE_ABSOLUTE=1.0  # Maximum position size (in SOL, converted to USDC using SOL_PRICE_USDC)

# SOL price for limit conversion (automatically fetched from Jupiter API if available, fallback to this value)
SOL_PRICE_USDC=

# Minimum profit requirements
# For first night run: use softer thresholds to see regular simulate_success
# After first night: raise thresholds based on hit-rate statistics
MIN_PROFIT_USDC=0.05  # PRIMARY: minimum profit in USDC (absolute, always applied) - softened for first night (was 0.1)
MIN_PROFIT_BPS=5  # SECONDARY: optional filter in basis points - softened for first night (was 50, set to 0 to disable)

# Slippage limits
MAX_SLIPPAGE_BPS=200  # Maximum allowed slippage (risk limit). SLIPPAGE_BPS must be <= this value
SLIPPAGE_BPS=100  # Actual slippage used in Jupiter API requests. Must be <= MAX_SLIPPAGE_BPS

# Position management
MAX_ACTIVE_POSITIONS=1  # Maximum number of simultaneous active positions (pending/executing)

# ----------------------------------------------------------------------------
# Arbitrage Configuration
# ----------------------------------------------------------------------------
# Deprecated: QUOTE_DELAY_SECONDS kept for backward compatibility
# Rate limiting is now handled by JupiterClient with strict 1 req/sec limit
QUOTE_DELAY_SECONDS=1.0

# ----------------------------------------------------------------------------
# Jupiter API Rate Limiting
# ----------------------------------------------------------------------------
# Strict rate limiting: 1 request per second to Jupiter API (applied to all quote/swap requests)
JUPITER_RPS=1.0  # Requests per second (default: 1.0, strict rate limiting)
JUPITER_MAX_RETRIES_ON_429=3  # Maximum retries on 429 rate limit error (default: 3)
JUPITER_BACKOFF_BASE_SECONDS=1.0  # Base backoff time for 429 retries (default: 1.0)
JUPITER_BACKOFF_MAX_SECONDS=30.0  # Maximum backoff time for 429 retries (default: 30.0)

# ----------------------------------------------------------------------------
# Transaction Configuration
# ----------------------------------------------------------------------------
PRIORITY_FEE_LAMPORTS=10000  # Priority fee for transactions (in lamports)
USE_JITO=false  # Use Jito for transaction bundling (requires Jito setup)

# ----------------------------------------------------------------------------
# Diagnostic Mode
# ----------------------------------------------------------------------------
# Set to true to test Jupiter route capability (makes one direct request SOL → USDC with relaxed parameters)
DIAGNOSTIC_MODE=false
DIAGNOSTIC_SLIPPAGE_BPS=500  # Slippage for diagnostic mode (separate from SLIPPAGE_BPS)
DIAGNOSTIC_AMOUNT_SOL=1.0  # Amount for diagnostic request (in SOL, default: 1.0)

# ----------------------------------------------------------------------------
# Non-stop Mode Configuration (for simulate/live modes)
# ----------------------------------------------------------------------------
# Balance refresh intervals (seconds)
# SOL: refresh every N seconds (0 = refresh every cycle)
BALANCE_REFRESH_SOL_EVERY_SEC=2.0
# USDC: refresh every N seconds
BALANCE_REFRESH_USDC_EVERY_SEC=15.0
# Force refresh USDC if balance is older than N seconds before USDC-base opportunity
BALANCE_FORCE_REFRESH_USDC_IF_OLDER_SEC=5.0
# RPC timeout for balance refresh (seconds)
BALANCE_REFRESH_RPC_TIMEOUT_SEC=2.0

# SOL price refresh (for risk management and profit calculation)
SOL_PRICE_REFRESH_EVERY_SEC=300  # Refresh SOL→USDC price every N seconds (default: 5 minutes)
SOL_PRICE_REFRESH_TIMEOUT_SEC=2.0  # Timeout for price fetch (seconds)
SOL_PRICE_REFRESH_LOG_EVERY_N=12  # Log price update every N refreshes (default: ~1 hour if 5min interval)

# Loop configuration
LOOP_IDLE_SLEEP_SEC=2.0  # Sleep time when no opportunities found (seconds)

# Inline arbitrage loop configuration (simulate/live modes)
INLINE_SUMMARY_EVERY_SEC=60.0  # Log aggregated summary every N seconds (default: 60)
NEGATIVE_CACHE_CLEANUP_EVERY_SEC=60.0  # Cleanup expired negative cache entries every N seconds (default: 60)

# Expiry rebuild configuration (live mode)
EXPIRY_REBUILD_HEADROOM_BLOCKS=150  # Rebuild VT if blocks_remaining <= this value (default: 150 blocks ~30s at 4 blocks/sec)

# Error handling (exponential backoff)
FAIL_BACKOFF_BASE_SEC=1.0  # Base backoff time (seconds)
FAIL_BACKOFF_MAX_SEC=30.0  # Maximum backoff time (seconds)

# ----------------------------------------------------------------------------
# Route Negative Cache (TTL-based filtering of unstable Jupiter routes)
# ----------------------------------------------------------------------------
# TTL for negative cache entries (seconds)
# Default: 600 (10 minutes)
NEGATIVE_CACHE_TTL_SEC=600

# TTL for atomic VT size overflow cache (seconds)
# Routes that fail with atomic_size_overflow (> 1232 bytes) are cached for this duration
# Range: 300-900 seconds (5-15 minutes), default: 600 (10 minutes)
NEGATIVE_CACHE_TTL_SIZE_OVERFLOW_SEC=600

# TTL for runtime 6024 + SharedAccountsRoute cache (seconds)
# Routes that fail with InstructionErrorCustom(6024) + "Instruction: SharedAccountsRoute" are cached for this duration
# Range: 300-900 seconds (5-15 minutes), default: 600 (10 minutes)
NEGATIVE_CACHE_TTL_RUNTIME_6024_SEC=600

# ----------------------------------------------------------------------------
# Logging
# ----------------------------------------------------------------------------
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO
